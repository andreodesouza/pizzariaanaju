<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pizzaria AnaJu</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>CardÃ¡pio</h2>
  <div id="menu" class="menu-grid"></div>

  <h2>Carrinho</h2>
  <div id="carrinho"></div>

  <div id="pagamento">
    <label for="formaPagamento"><strong>Forma de Pagamento:</strong></label>
    <select id="formaPagamento">
      <option value="Dinheiro">Dinheiro</option>
      <option value="Pix">Pix</option>
      <option value="CartÃ£o na Entrega">CartÃ£o na Entrega</option>
      <option value="CartÃ£o Online">CartÃ£o Online</option>
    </select>
  </div>

  <button onclick="finalizarPedido()">Finalizar no WhatsApp</button>

  <script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbzfJiL_pKPj3VIMqKBl-4B0jgwYJQalUICj9zaWtwYp6oDAgKW-w5xBthxSMG9Zq8gW/exec';

    let carrinho = [];

    async function carregarCardapio() {
      const response = await fetch(webAppUrl);
      const menuItems = await response.json();
      const menuDiv = document.getElementById('menu');

      menuItems.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.classList.add('item-card');

        itemDiv.innerHTML = `
          <img src="${item.imagem}" alt="${item.nome}" class="item-img">
          <p><strong>${item.nome}</strong> - R$${item.preco.toFixed(2)}</p>
          <p>${item.descricao}</p>
          <div class="quantidade-controls">
            <button onclick="alterarQuantidade(${item.codigo}, -1)">-</button>
            <span id="qtd-${item.codigo}">1</span>
            <button onclick="alterarQuantidade(${item.codigo}, 1)">+</button>
          </div>
          <button onclick="adicionarAoCarrinho(${item.codigo}, '${item.nome}', ${item.preco})">Adicionar</button>
        `;
        menuDiv.appendChild(itemDiv);
      });
    }

    function alterarQuantidade(codigo, delta) {
      const span = document.getElementById(`qtd-${codigo}`);
      let quantidadeAtual = parseInt(span.textContent);
      quantidadeAtual += delta;
      if (quantidadeAtual < 1) quantidadeAtual = 1;
      span.textContent = quantidadeAtual;
    }

    function adicionarAoCarrinho(codigo, nome, preco) {
      const span = document.getElementById(`qtd-${codigo}`);
      const quantidade = parseInt(span.textContent) || 1;

      const itemExistente = carrinho.find(item => item.codigo === codigo);

      if (itemExistente) {
        itemExistente.quantidade += quantidade;
        itemExistente.total = itemExistente.quantidade * itemExistente.preco;
      } else {
        carrinho.push({ codigo, nome, quantidade, preco, total: preco * quantidade });
      }
      atualizarCarrinho();
    }

    function atualizarCarrinho() {
      const carrinhoDiv = document.getElementById('carrinho');
      carrinhoDiv.innerHTML = '';
      let totalGeral = 0;

      carrinho.forEach((item, index) => {
        totalGeral += item.total;
        const itemDiv = document.createElement('div');
        itemDiv.classList.add('carrinho-item');
        itemDiv.innerHTML = `
          ${item.nome} - Quantidade: ${item.quantidade} - Total: R$${item.total.toFixed(2)}
          <button onclick="removerItem(${index})">Remover</button>
        `;
        carrinhoDiv.appendChild(itemDiv);
      });

      if (carrinho.length > 0) {
        const totalDiv = document.createElement('div');
        totalDiv.classList.add('total');
        totalDiv.innerHTML = `Total Geral: R$${totalGeral.toFixed(2)}`;
        carrinhoDiv.appendChild(totalDiv);
      }
    }

    function removerItem(index) {
      carrinho.splice(index, 1);
      atualizarCarrinho();
    }

    function finalizarPedido() {
      const formaPagamento = document.getElementById('formaPagamento').value;

      let mensagem = 'ðŸ“¦ Pedido:\n';
      let totalGeral = 0;

      carrinho.forEach(item => {
        mensagem += `- ${item.nome} (Qtd: ${item.quantidade}) - R$ ${item.total.toFixed(2)}\n`;
        totalGeral += item.total;
      });

      mensagem += `\nðŸ’° Total: R$ ${totalGeral.toFixed(2)}`;
      mensagem += `\nðŸ’³ Forma de Pagamento: ${formaPagamento}`;

      if (formaPagamento === "Pix") {
        mensagem += `\nðŸ”— Pix: https://seusite.com/pix?valor=${totalGeral.toFixed(2)}`;
      } else if (formaPagamento === "CartÃ£o Online") {
        mensagem += `\nðŸ”— Pagamento Online: https://mpago.la/abc123`; // substitua pelo seu link real
      }

      const numeroWhatsApp = '22974044370';
      const urlWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;

      window.location.href = urlWhatsApp;
    }

    window.onload = carregarCardapio;
  </script>
</body>
</html>
